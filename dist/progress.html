<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <my-progress id="progress" width="400px" height="40px"></my-progress>
    <style>
        search-box:not(:defined) {
                display: flex;
                width: 200px;
                height: 40px;
                background: white;
                align-items: center;
                border-radius: 5px;
                border: 1px solid #333;
                box-sizing: border-box;
                cursor: pointer;
                user-select: none;
            }
            search-box input{
                border: none;
                outline: none;
                width: 70%;
            }
            search-box span:last-child {
                font-size: 2em;
            }
            search-box .icon {
                width: 15%;
                text-align: center;
            }
            inline-cicle {
                display: inline-block;
                width: 1em;
                height: 1rem;
                border-radius: 50%;
                background: white;
                border: 1px solid black;
                vertical-align: bottom;
            }
    </style>
    
    <search-box id="search-zj">
        <span slot="left" class="icon">ğŸ”</span>
        <input type="text" placeholder="æœç´¢...">
        <span slot="right" class="icon">Ã—</span>
    </search-box>
    <p>
            è¯´åˆ°ä¸­å›½å†å²ä¸Šæœ‰å…³å¥¸è‡£çš„å…¸æ•…ï¼Œå¾ˆå¤šäººä¼šæƒ³åˆ°<inline-cicle ></inline-cicle>â€œæŒ‡é¹¿ä¸ºé©¬â€çš„èµµé«˜ï¼Œâ€œè·¯äººçš†çŸ¥â€çš„å¸é©¬æ˜­ä»¥åŠâ€œå†²å† ä¸€æ€’â€çš„å´ä¸‰æ¡‚ç­‰ç­‰ã€‚
            å…¶å®åœ¨ä»–ä»¬ä¹‹ä¸­è¿˜æœ‰å‡ ä¸ªå…¸æ•…æ¯”è¾ƒæœ‰æ„æ€ï¼Œé‚£å°±æ˜¯<inline-cicle ></inline-cicle>â€œè«é¡»æœ‰â€ã€<inline-cicle ></inline-cicle>â€œæ„æœ‰ä¹‹â€å’Œ<inline-cicle ></inline-cicle>â€œæ°´å¤ªå‡‰â€ï¼Œæœ‰çš„æœ‹å‹å¯èƒ½ä¸è¯´å°±å·²ç»çŸ¥é“è¿™ä¸‰äººåˆ†åˆ«æŒ‡çš„æ˜¯è°äº†ï¼Œ
            ä»–ä»¬åˆ†åˆ«æŒ‡çš„æ˜¯<inline-cicle ></inline-cicle>å®³æ­»å²³é£çš„ç§¦æ¡§ã€<inline-cicle ></inline-cicle>å®³æ­»äºè°¦çš„å¾æœ‰è´ã€<inline-cicle ></inline-cicle>ä¸æ¸…ä¸æ˜çš„é’±è°¦ç›Šï¼ˆæ­¤äººèº«ä¸ºæ˜æœçš„å®˜å‘˜ä¸ä¸ºæ˜æœåŠæ­£äº‹ï¼ŒæŠ•é™æ¸…æœåˆä¸ä¸ºæ¸…æœåŠæ­£äº‹ï¼Œæ‰€ä»¥å·ç§°â€œä¸æ˜ä¸æ¸…â€ï¼‰ã€‚
            ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸‰ä¸ªå…¸æ•…çš„ç”±æ¥ï¼š
    </p>

    <script src="./simpler-progress.js"></script>
    <script>
        // let pr = new RollupDemo();
        // console.log("åˆå§‹åŒ–ï¼š", RollupDemo.percentage);
        
    </script>
    <script>
        // let ins = new RollupDemo({elem: "progress"});
        // ins.builder();
        class SearchBox extends HTMLElement {
            constructor() {
                super();// è°ƒç”¨è¶…ç±»çš„æ„é€ å™¨
                // åˆ›å»ºä¸€ä¸ªå½±å­ DOM æ ‘å¹¶å°†å…¶é™„åŠ åˆ°è¿™ä¸ªå…ƒç´ 
                // è®¾ç½®ä¸º this.shadowRoot çš„å€¼
                this.attachShadow({mode:'open'});
                
                // å…‹éš†æ¨¡æ¿ï¼Œå®šä¹‰è‡ªå®šä¹‰ç»„ä»¶çš„åä»£åŠæ ·å¼
                // ç„¶åå§å†…å®¹è¿½åŠ åˆ°å½±å­æ ¹èŠ‚ç‚¹
                this.shadowRoot.append(SearchBox.template.content.cloneNode(true));
                
                // å–å¾—å¯¹å½±å­DOMä¸­é‡è¦å…ƒç´ çš„å¼•ç”¨
                this.input = this.shadowRoot.querySelector('input');
                let leftSlot = this.shadowRoot.querySelector('slot[name="left"]');
                let rightSlot = this.shadowRoot.querySelector('slot[name="right"]');
                
                // å½“å†…éƒ¨è¾“å…¥å­—æ®µè·å¾—å¤±å»ç„¦ç‚¹æ—¶ï¼Œè®¾ç½®æˆ–ç§»é™¤
                // focused å±æ€§ï¼Œä»¥ä¾¿æ ·å¼è¡¨åœ¨æ•´ä¸ªç»„ä»¶æ˜¾ç¤ºæˆ–éšè—äººé€ çš„ç„¦ç‚¹ç¯ã€‚æ³¨æ„ï¼Œblurï¼Œfocus
                // ç°åœ¨å˜é‡Xçš„å€¼å°±æ˜¯0ã€‚äº‹ä»¶ä¼šå†’æ³¡ï¼Œå°±åƒèµ·æºè‡ª<search-box>ä¸€æ ·
                console.log('onfocusï¼š',leftSlot);

                this.input.onfocus = ()=> {
                    this.setAttribute('focused', '')
                };
                this.input.onblur = ()=>{
                    this.removeAttribute('focused')
                };
                
                // å¦‚æœç‚¹å‡»äº†æ”¾å¤§é•œï¼Œåˆ™è§¦å‘searchï¼Œ è¾“å…¥æ—¶ change äº‹ä»¶ä¹Ÿè§¦å‘è¿™ä¸ªäº‹ä»¶
                // changeäº‹ä»¶ä¸ä¼šå½±å“åˆ°å½±å­DOMå¤–è¾¹
                leftSlot.onclick = this.input.onchange = (event) =>{
                    event.stopPropagation();// é˜»æ­¢å•å‡»äº‹ä»¶å†’æ³¡
                    if(this.disabled) return ;// ç¦ç”¨åˆ™å•¥ä¹Ÿä¸åš
                    this.dispatchEvent(new CustomEvent('search', {
                        detail: this.input.value
                    }))
                    
                }
                
                // å•å‡»Xï¼Œåˆ™è§¦å‘ clear äº‹ä»¶. å¤„ç†ç¨‹åºæ²¡æœ‰è°ƒç”¨ preventDefault(), åˆ™æ¸…é™¤è¾“å…¥
                rightSlot.onclick = (event) => {
                    event.stopPropagation();// ä¸è®©äº‹ä»¶å‘ä¸Šå†’æ³¡
                    if(this.disabled) return;// å¦‚æœç¦ç”¨å•¥ä¹Ÿä¸åš
                    let e = new CustomEvent('clear', {cancelable: true});
                    this.dispatchEvent(e);
                    console.log('è¿™æ˜¯å•¥ï¼Ÿ', e);
                    if(!e.defaultPrevented) {// å¦‚æœäº‹ä»¶æ²¡æœ‰è¢«å–æ¶ˆ
                        this.input.value = '';
                    }
                }
            
            }        
            // åœ¨æœ‰äº›å±æ€§è¢«è®¾ç½®æˆ–æ”¹å˜æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®å†…éƒ¨<input >
            // å…ƒç´ å¯¹åº”çš„å€¼ï¼Œè¿™ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸ä¸‹é¢ä»£ç çš„é™æ€å±æ€§
            // observedAttrubutes ç›¸äº’é…åˆï¼Œå®ç°å›è°ƒ
            attributeChangedCallback(name, oldValue, newValue) {
                if(name === 'disabled') {
                    this.input.disabled = (newValue !== null)
                } else if(name === 'placeholder') {
                    this.input.placeholder = newValue
                } else if(name === 'value') {
                    this.input.value = newValue
                }
            }
            
            // æœ€åï¼Œä¸ºæˆ‘ä»¬æ”¯æŒçš„HTMLå±æ€§å®šä¹‰ç›¸åº”çš„è·å–æ–¹æ³•å’Œè®¾ç½®æ–¹æ³•
            // è·å–æ–¹æ³•ç®€å•çš„è¿”å›å±æ€§çš„å€¼ã€‚å½“æŸä¸ªåœ°æ–¹è®¾ç½®ä¿®æ”¹äº†å€¼æ—¶ï¼Œ è‡ªåŠ¨è°ƒç”¨ä¸Šè¾¹çš„  attributeChangedCallback
            get placeholder() { return this.getAttribute('placeholder')}
            get size() { return this.getAttribute('size')}
            get size() { return this.getAttribute('value')}
            get disabled() { return this.getAttribute('disabled')}
            get hidden() { return this.getAttribute('hidden')}
            
            set placeholder(val) { return this.setAttribute('placeholder', val)}
            set size(val) { return this.setAttribute('size', val)}
            set size(text) { return this.setAttribute('size', text)}
            set disabled(val) {
                if(val) {
                    this.setAttribute('disabled', val)
                } else {
                    this.removeAttribute('disabled')
                }
            }
            set hidden(val) { 
                if(val) {
                    this.setAttribute('hidden', '')
                } else {
                    this.removeAttribute('hidden')
                }
            }
        }
        
        // è¿™ä¸ªé™æ€å±æ€§å¯¹ attributeChangedCallback æ–¹æ³•æ˜¯å¿…é¡»çš„ï¼Œåªæœ‰åœ¨è¿™ä¸ªæ•°ç»„ä¸­åˆ—å‡ºçš„å±æ€§åæ‰ä¼šè§¦å‘å¯¹è¯¥æ–¹æ³•çš„è°ƒç”¨
        SearchBox.observedAttributes = ['disabled', 'placeholder', 'size', 'value'];

        // åˆ›å»ºä¸€ä¸ª template å…ƒç´ ï¼Œç”¨äºä¿å­˜æ ·å¼å’Œå…ƒç´ æ ‘
        // å¯ä»¥åœ¨æ¯ä¸ª SearchBox å…ƒç´ çš„å®ä¾‹ä¸­ä½¿ç”¨å®ƒé—¨
        SearchBox.template = document.createElement('template');

        // é€šè¿‡è§£æHTMLå­—ç¬¦ä¸²æ¨¡æ¿åˆå§‹åŒ–ï¼Œé€šè¿‡å…‹éš†è¿™ä¸ªæ¨¡æ¿ä¸­çš„èŠ‚ç‚¹ï¼Œä¸éœ€è¦å†æ¬¡è§£æHTML

        SearchBox.template.innerHTML = `
            <style>
                /*
                *è¿™é‡Œçš„:hosté€‰æ‹©ç¬¦å¼•ç”¨çš„æ˜¯é˜³å…‰DOMä¸­åšçš„<search-box>å…ƒç´ ï¼Œè¿™äº›æ ·å¼æ˜¯é»˜è®¤çš„ï¼Œ
                *<search-box>çš„ä½¿ç”¨è€…å¯ä»¥é€šè¿‡é˜³å…‰DOMä¸­çš„æ ·å¼æ¥è¦†ç›–è¿™äº›æ ·å¼
                */
                :host {
                    display: inline-block;
                    border: solid black 1px;
                    border-radius: 5px;
                    padding: 4px 6px;
                }
                :host([hidden]) {
                    display: none;
                }

                :host([focused]) {
                    box-shadow: 0 0 2px 2px #6AE;
                }

                input {
                    border-width: 0;outline: none; font: inherit; background: inherit;
                }
                slot {
                    cursor: default; user-select:none;
                }
            </style>
            <div>
                <slot name="left" >\u{1f50d}</slot>
                <input type="text" placeholder="æœç´¢...">
                <slot name="right" >\u{2573}</slot>
            </div>
            
        `;
        // æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨ customElements.define()å°†SearchBoxå…ƒç´ ï¼Œæ³¨å†Œä¸º<search-box>æ ‡ç­¾çš„å®ç°ã€‚è‡ªå®šä¹‰å…ƒç´ çš„æ ‡ç­¾ä¸­å¿…é¡»åŒ…å«ä¸€ä¸ªè¿å­—ç¬¦
        customElements.define('search-box', SearchBox);

        document.getElementById("search-zj").onsearch = function(e) {
            console.log("search:", e);
        }
    </script>
</body>
</html>